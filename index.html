<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/FileLoader.css">

    <!-- D3/jquery/bootstrap -->
    <script src="https://d3js.org/d3.v5.min.js"
            integrity="sha384-M06Cb6r/Yrkprjr7ngOrJlzgekrkkdmGZDES/SUnkUpUol0/qjsaQWQfLzq0mcfg"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <!-- Common Functionalities Shared Among Pages -->
    <script src="js/common.js"></script>

    <!-- JavaScript for UntangleJS -->
    <script src="untangleJS/lib/DisjointSet.js"></script>
    <script src="untangleJS/lib/MaximalSpanningTree.js"></script>
    <script src="untangleJS/lib/JaccardWeights.js"></script>
    <script src="untangleJS/lib/NodeDegree.js"></script>
    <script src="untangleJS/lib/PriorityQueue.js"></script>
    <script src="untangleJS/SpanningTreeLayout.js"></script>
    <script src="untangleJS/SpanningTreeCycles.js"></script>
    <script src="untangleJS/LoopForce.js"></script>
    <script src="untangleJS/PH0D.js"></script>
    <script src="untangleJS/PH1D.js"></script>
    <script src="untangleJS/GraphDraw.js"></script>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
    <link rel="manifest" href="images/favicon/site.webmanifest">    
    <meta name="theme-color" content="#ffffff">    

    <title>Untangling Force-Directed Layouts with Persistent Homology</title>

</head>
<body>


    <style>


        </style>

<div class="page" style="padding: 15px; background-color: #808080; background-size: contain; background-repeat: no-repeat; background-position: right center; background-image: url(images/background.png);">
    <h2 style="margin: 0; font-weight: bold; color:#fff">Untangling Force-Directed Layouts with Persistent Homology</h2>
</div>

<div style="width: 90%; padding: 40px; padding-bottom:0; text-align: justify;">
    <h4>Abstract</h4>
    Force-directed layouts belong to a popular class of methods used to position nodes in a node-link diagram. However, they typically lack direct consideration of global structures, which can result in visual clutter and the overlap of unrelated structures. In this work, we leverage persistent homology features of an undirected graph as derived information for interactive manipulation of force-directed layouts thus mitigating these issues. First, we devise a new method to use 0-dimensional persistent homology to efficiently generate an initial graph layout. The approach results in faster convergence and better quality graph layouts. We then use interactive persistence barcode to manipulate the force-directed graph layout by adding and removing contracting and repulsing forces generated by the 0-dimensional persistent homology features (i.e., components). Finally, we provide users the ability to interact with these 1-dimensional features (i.e., tunnels/cycles) by highlighting them and adding cycle-emphasizing forces to the layout.
</div>


<div class="page" id="show_results" style="padding: 40px;">
    <div style="display: flex;">
        <div style="width: fit-content">
            <div style="width: fit-content">
                <input type="range" min="0" max="100" value="0" width="200" class="slider" id="myRange" oninput="update_ph(this);">
            </div>
            <div style="width: fit-content">
                <svg id="barcode" width=150 height=600></svg>
            </div>
            <div style="width: fit-content; margin: auto">
                H<sub>0</sub> Features
            </div>
        </div>
        <div style="width: fit-content">
            <div style="width: fit-content; padding-top: 24px">
                <svg id="barcode1d" width=150 height=600></svg>
            </div>
            <div style="width: fit-content; margin: auto">
                H<sub>1</sub> Features
            </div>
        </div>
        <div>
            <svg id="graph" width=800 height=625></svg>
        </div>
        <div style="margin: 20pt; text-align: center">

            <p>Initial Layout</p>
            <div style="margin: 5pt"><input type="button" id="btn-radial_layout"  class="btn btn-filled" value="Radial Layout (our approach)" onclick="reset_graph('radial_layout')"/></div>
            <div style="margin: 5pt"><input type="button" id="btn-layered_layout" class="btn btn-empty" value="Layered Layout (our approach)" onclick="reset_graph('layered_layout')"/></div>
            <div style="margin: 5pt"><input type="button" id="btn-random" class="btn btn-empty" value="Random Layout (conventional)" onclick="reset_graph('random')"/></div>
            <hr>
            <p>Color Nodes By...</p>
            <div class="form-check" style="margin: auto; width: 120px">
                <input class="form-check-input" type="radio" name="color_by" id="color_by_group" onclick="update_colors()">
                <label class="form-check-label" for="color_by_group">Group</label>
            </div>
            <div class="form-check" style="margin: auto; width: 120px">
                <input class="form-check-input" type="radio" name="color_by" id="color_by_degree_ranked" onclick="update_colors()" checked>
                <label class="form-check-label" for="color_by_degree_ranked">Degree</label>
            </div>
            <hr>
            <div style="margin: 5pt"><input type="button" id="btn-export" class="btn btn-filled" value="Export Graph as JSON" onclick="downloadGraph()"/></div>
        </div>
    </div>
</div>



    <div style="width: 90%; padding: 40px; padding-bottom:0; text-align: justify;">
        <h4>Contributors</h4>
        <a href="https://cspaul.com">Paul Rosen</a>, University of Utah<br>
        <a href="http://www.sci.utah.edu/~beiwang/">Bei Wang</a>, University of Utah<br>
        <a href="https://cscheid.net/">Carlos Scheidegger</a>, RStudio<br>
        <a href="https://www.eecs.tufts.edu/~asuh/">Ashley Suh</a>, Tufts University<br>
        Bhavana Doppalapudi, University of South Florida<br>
        <a href="https://www.mustafahajij.com/">Mustafa Hajij</a>, University of San Francisco
    
        <h4 style="margin-top: 20px; ">Citations</h4>
        <p style="font-size: 18px;">
            <ul>
                <li>Bhavana Doppalapudi, Bei Wang, and Paul Rosen. <i>Untangling Force-Directed Layouts Using Persistent Homology</i>, IEEE Workshop on Topological Data Analysis and Visualization (TopoInVis), 2022. <a href="https://arxiv.org/abs/2208.06927" target="_blank">https://arxiv.org/abs/2208.06927</a></li>
                <li>Ashley Suh, Mustafa Hajij, Bei Wang, Carlos Scheidegger, and Paul Rosen. <i>Persistent Homology Guided Force-Directed Graph Layouts</i>, IEEE Transactions on Visualization and Computer Graphics (Proceedings of InfoVIS), 2019. <a href="https://arxiv.org/abs/1712.05548" target="_blank">https://arxiv.org/abs/1712.05548</a> | <a href="https://ieeexplore.ieee.org/document/8807379" target="_blank">https://ieeexplore.ieee.org/document/8807379</a></li>
            </ul>
        </p>
        <h4 style="margin-top: 10px; ">Acknowledgments</h4>
        <p>This work was partially supported by the National Science Foundation (IIS-1513616, IIS-1845204, and DBI-1661375), Department of Energy (DOE) DE-SC0021015, CRA-W Collaborative Research Experiences for Undergraduates (CREU) program, DARPA CHESS FA8750-19-C-0002, and
            an NVIDIA Academic Hardware Grant.</p>
    </div>
    
</body>




<script>

let graph = null
let ph0d = null
let ph1d = null
let graphDraw = null
let stlayout = null
let filename = 'bcsstk.json'


function change_dataset(_graph){

    let start_time = performance.now()

    graph = _graph;

    let end_time = performance.now()
    console.log( "Data Download/Parse: " + (end_time - start_time) + " ms")

    console.log( graph.nodes.length + " nodes; " + graph.links.length + " links" )

    document.getElementById('myRange').value = 0
    d3.select("#barcode").selectAll("*").remove();
    d3.select("#barcode1d").selectAll("*").remove();

    // For graphs without weights
    start_time = performance.now()
    let weightRange = d3.extent( graph.links, l=> ('value' in l) ? l.value : 1 )
    if( weightRange[1] - weightRange[0] === 0)
        calculate_jaccard_weights(graph)
    calculate_node_degree(graph)
    end_time = performance.now()
    console.log( "Weight Calculation (Jaccard): " + (end_time - start_time) + " ms")

    start_time = performance.now()
    stlayout = SpanningTreeLayout(graph)
    end_time = performance.now()
    console.log( "Spanning Tree Calculation: " + (end_time - start_time) + " ms")

    start_time = performance.now()
    ph0d = PersistentHomology0D("#barcode", graph, stlayout.spanning_tree())
    end_time = performance.now()
    console.log( "PH0D Calculation: " + (end_time - start_time) + " ms")

    start_time = performance.now()
    ph1d = PersistentHomology1D("#barcode1d", graph, stlayout.spanning_tree())
    end_time = performance.now()
    console.log( "PH1D Calculation: " + (end_time - start_time) + " ms")

    reset_graph()
}


function update_colors(){
    update_graph_draw_colors(graphDraw,
                             document.getElementById('color_by_group').checked,
                             false, //document.getElementById('color_by_degree').checked,
                             document.getElementById('color_by_degree_ranked').checked )
}

function reset_graph( layout_method="radial_layout" ){
    d3.select("#graph").selectAll("*").remove();
    d3.select("#convergence").selectAll("*").remove();
    d3.select("#dist_pres").selectAll("*").remove();
    layouts.forEach( l => {
        document.getElementById("btn-"+l).setAttribute("class", "btn " + ( l === layout_method ? "btn-filled": "btn-empty" ) )
    })

    // Clear any existing node positions
    graph.nodes.forEach(n=>{
      delete n.x
      delete n.y
    })

    // Initialize Layout
    let start_time = performance.now()
    if( layout_method === 'radial_layout') stlayout.radial_layout([5,795],[5,595])
    if( layout_method === 'layered_layout') stlayout.layered_layout([5,795],[5,595])
    let end_time = performance.now()
    console.log( "Layout Time ("+layout_method+"): " + (end_time - start_time) + " ms")

    // Draw Graph
    start_time = performance.now()
    graphDraw = GraphDraw(graph).set_tick_callback( ()=>{ } )
                                 .set_click_callback( (d)=>console.log(d) )

    update_colors()
    end_time = performance.now()
    console.log( "Initialize FDL Time: " + (end_time - start_time) + " ms")

    if( ph0d ) ph0d.set_graph_draw(graphDraw)
    if( ph1d ) ph1d.set_graph_draw(graphDraw)

}

function update_ph(slider){
    ph0d.update_threshold(slider.value)
}


const downloadGraph = () => {
    downloadText(graphDraw.get_json(),filename.substring( 0, filename.length-5) + '_untangled.json')
}

d3.json( 'sample_data/' + filename).then( change_dataset )

</script>


</html>
